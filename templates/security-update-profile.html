<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Profile - Security</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div class="dashboard">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>üîê Condo Access</h2>
                <div class="user-info"><div>{{officer.full_name}}</div><div>{{officer.contact_number}}</div></div>
            </div>
            <nav>
                <ul class="nav-menu">
                    <li class="nav-item"><a href="/?officer_id={{ officer.officer_id }}" class="nav-link">üìπ Monitor Cameras</a></li>
                    <li class="nav-item"><a href="/security-override?officer_id={{ officer.officer_id }}" class="nav-link">üö™ Manual Override</a></li>
                    <li class="nav-item"><a href="/security-view-profile?officer_id={{ officer.officer_id }}" class="nav-link">üë§ View Profile</a></li>
                    <li class="nav-item"><a href="/security-update-profile?officer_id={{ officer.officer_id }}" class="nav-link active">‚úèÔ∏è Update Profile</a></li>
                    <li class="nav-item"><a href="/security-deactivate?officer_id={{ officer.officer_id }}" class="nav-link">‚ö†Ô∏è Deactivate Account</a></li>
                    <li class="nav-item"><a href="/security-face-verification?officer_id={{ officer.officer_id }}" class="nav-link">üîç Face Verification</a></li>
                    <li class="nav-item"><a href="/" class="nav-link" style="margin-top:20px;border-top:1px solid rgba(255,255,255,0.1);padding-top:20px;">üö™ Logout</a></li>
                </ul>
            </nav>
        </aside>
        <main class="main-content">
            <div class="page-header"><h1>Update Profile</h1><p>Update your security officer information</p></div>
            <div class="card">
                <div class="card-header"><h2>‚úèÔ∏è Edit Personal Information</h2></div>
                <div class="card-body">
                    <form id="updateForm">
                        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;">
                            <div class="form-group">
                                <label>Full Name</label>
                                <input type="text" id="fullName" value="{{officer.full_name}}" class="form-control">
                            </div>
                            <div class="form-group">
                                <label>Contact Number</label>
                                <input type="tel" id="phone" value="{{officer.contact_number}}" class="form-control">
                            </div>
                            <!-- <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="email" value="david.wong@security.com" class="form-control">
                            </div> -->
                            <div class="form-group">
                                <label>Shift Preference</label>
                                <select id="shift" class="form-control">
                                    <option value="AM" {% if officer.shift == 'AM' %}selected{% endif %}>AM</option>
                                    <option value="PM" {% if officer.shift == 'PM' %}selected{% endif %}>PM</option>
                                    <option value="Graveyard" {% if officer.shift == 'Graveyard' %}selected{% endif %}>Graveyard</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Emergency Contact Name</label>
                            <input type="text" id="emergencyName" value="Lisa Wong" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Emergency Contact Number</label>
                            <input type="tel" id="emergencyPhone" value="+65 9123 4567" class="form-control">
                        </div>
                        <button type="button" class="btn btn-primary" onclick="updateProfile()" style="width:100%;">üíæ Update Profile</button>
                    </form>
                    <div id="message" class="message"></div>
                </div>
            </div>
            <div class="card">
                <div class="card-header"><h2>üîí Change Password</h2></div>
                <div class="card-body">
                    <form id="passwordForm">
                        <div class="form-group">
                            <label>Current Password</label>
                            <input type="password" id="currentPwd" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>New Password</label>
                            <input type="password" id="newPwd" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Confirm New Password</label>
                            <input type="password" id="confirmPwd" class="form-control">
                        </div>
                        <button type="button" class="btn btn-primary" onclick="changePassword()" style="width:100%;">üîê Change Password</button>
                    </form>
                    <div id="pwdMessage" class="message"></div>
                </div>
            </div>
        </main>
    </div>
    <script>
        async function updateProfile() {
            const full_name = document.getElementById('fullName').value;
            const contact_number = document.getElementById('phone').value;
            const shift = document.getElementById('shift').value;

            if (!full_name) {
                showMsg('message', 'Name is required', 'error');
                return;
            }

            try {
                const response = await fetch("/api/update-officer", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        full_name,
                        contact_number,
                        shift
                    })
                });

                const result = await response.json();

                if (response.ok) {
                    showMsg('message', 'Profile updated successfully!', 'success');
                } else {
                    showMsg('message', result.error || "Failed to update", 'error');
                }
            } catch (err) {
                showMsg('message', 'Server error', 'error');
                console.error(err);
            }
        }
    </script>
</body>
</html>
